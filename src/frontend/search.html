<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="node_modules/bootstrap/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />

    <title>Ristorante Con Fusion</title>
  </head>

  <body>
    <header class="jumbotron">
      <div class="container">
        <div class="row row-header">
          <div class="col-12 col-md-6">
            <h1>Movie Search</h1>
          </div>
          <div class="col col-md"></div>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="row align-items-center ">
        <div class="col-12 col-md-2">Select Field</div>
        <div class="col-12 col-md-2" id="dropDown"></div>
      </div>

      <div id='textQuery' class="row align-items-center">
        <div>Query:</div>
        <div><input type="text"></div>
      </div>
      <div id='numQuery' class="row align-items-center">
        <div>Budget</div>
        <div>>=</div>
      </div>

      <div class="row align-items-center">
        <div class="col-12 col-md-2">
          <button type="button" class="btn btn-primary" onCLick=go()>Primary</button>
        </div>
      </div>


      <div class="row align-items-center"></div>
      <table class="table ">
          <thead>
            <tr id='headerRow'>

            </tr>
          </thead>
          <tbody id="bodyBoy">

          </tbody>
        </table>
        </div>
    </div>

    <!-- jQuery first, then Popper.js, then Bootstrap JS. -->
    <script src="node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script src="node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script>

      //Data from the query
      var data;

      //Initial setting to hide the query options
      $('#textQuery').show()
      $('#numQuery').hide()

      //Global flag for type of query 
      var isNumeric = false;

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          // Typical action to be performed when the document is ready:
          data = JSON.parse(xhttp.responseText);

          console.log(Object.keys(data));
        Object.keys(data).forEach(item=>{

          $("#headerRow").append('<th>'+item+'</th>')

        })

          for (var val in Object.keys(data)) {
            $("<option />", {
              text: Object.keys(data)[val],
              value: data[Object.keys(data)[val]]
            }).appendTo(s);
          }

          s.appendTo("#dropDown");

          $("#fieldSelector").change(function () {
            if(this.value=='numeric'){
              $('#textQuery').hide()
              $('#numQuery').show()
              isNumeric = !isNumeric;

            }
            else{
              $('#textQuery').show()
              $('#numQuery').hide()
              isNumeric = !isNumeric;
            }
          });
        }
      };
      xhttp.open("GET", "http://localhost:5000/headers", true);
      xhttp.send();
      var s = $("<select id='fieldSelector'/>");


 


      function go(){    
        
 
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          // Typical action to be performed when the document is ready:
          let records = JSON.parse(xhttp.responseText);
          records.forEach(element => {
          
          let dataStr = '<tr>'
              Object.keys(data).forEach(item=>{

            dataStr+='<td>'+element[item]+'</td>'


          })
          dataStr+='</tr>'
           $("#bodyBoy").append(dataStr);

          });

        }
      };
      xhttp.open("GET", "http://localhost:5000/searchNumeric?search_field=popularity&search_query=28&search_inequality=1", true);
      xhttp.send();
      }





    </script>
  </body>
</html>
